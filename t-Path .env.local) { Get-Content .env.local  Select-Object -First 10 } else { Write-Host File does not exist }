[1mdiff --git a/src/middleware.ts b/src/middleware.ts[m
[1mindex d02b1cb..44ba415 100644[m
[1m--- a/src/middleware.ts[m
[1m+++ b/src/middleware.ts[m
[36m@@ -1,113 +1,56 @@[m
 import { NextResponse } from 'next/server'[m
 import type { NextRequest } from 'next/server'[m
 [m
[31m-// Define protected routes[m
[31m-const protectedRoutes = {[m
[31m-  admin: ['/admin'],[m
[31m-  candidate: ['/candidate'],[m
[31m-  voter: ['/voter'][m
[31m-}[m
[31m-[m
[31m-// Define public routes that don't require authentication[m
[31m-const publicRoutes = [[m
[31m-  '/',[m
[31m-  '/auth/signin',[m
[31m-  '/candidate/login',[m
[31m-  '/candidate/signup',[m
[31m-  '/candidate/register',[m
[31m-  '/voter/login',[m
[31m-  '/api/voter/send-otp',[m
[31m-  '/api/voter/verify-otp',[m
[31m-  '/api/voter/login',[m
[31m-  '/elections'[m
[32m+[m[32m// Define allowed public routes - only landing page and admin login pages[m
[32m+[m[32mconst allowedRoutes = [[m
[32m+[m[32m  '/',                    // Landing page[m
[32m+[m[32m  '/admin/login',         // Admin login page[m
[32m+[m[32m  '/auth/signin',         // Admin signin (NextAuth)[m
 ][m
 [m
[31m-// Simple JWT decode without verification (for Edge Functions)[m
[31m-// Full verification happens in API routes[m
[31m-function decodeToken(token: string): { userId?: string; role?: string } | null {[m
[31m-  try {[m
[31m-    const base64Url = token.split('.')[1][m
[31m-    if (!base64Url) return null[m
[31m-    const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/')[m
[31m-    const jsonPayload = decodeURIComponent([m
[31m-      atob(base64)[m
[31m-        .split('')[m
[31m-        .map((c) => '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2))[m
[31m-        .join('')[m
[31m-    )[m
[31m-    return JSON.parse(jsonPayload)[m
[31m-  } catch {[m
[31m-    return null[m
[31m-  }[m
[31m-}[m
[31m-[m
[31m-// Check if token exists and has basic structure (lightweight check for middleware)[m
[31m-function hasValidTokenStructure(token: string): boolean {[m
[31m-  return token.split('.').length === 3[m
[31m-}[m
[32m+[m[32m// API routes that should remain accessible for login functionality[m
[32m+[m[32mconst allowedApiRoutes = [[m
[32m+[m[32m  '/api/auth',            // NextAuth API routes[m
[32m+[m[32m  '/api/admin',           // Admin API routes (for login)[m
[32m+[m[32m  '/api/health',          // Health check[m
[32m+[m[32m][m
 [m
 export function middleware(request: NextRequest) {[m
   const { pathname } = request.nextUrl[m
   [m
[31m-  // Allow public routes[m
[31m-  if (publicRoutes.some(route => pathname.startsWith(route))) {[m
[32m+[m[32m  // Allow static files and Next.js internals[m
[32m+[m[32m  if ([m
[32m+[m[32m    pathname.startsWith('/_next') ||[m
[32m+[m[32m    pathname.startsWith('/favicon.ico') ||[m
[32m+[m[32m    pathname.startsWith('/logo') ||[m
[32m+[m[32m    pathname.match(/\.(ico|png|jpg|jpeg|svg|gif|webp|mp4)$/)[m
[32m+[m[32m  ) {[m
     return NextResponse.next()[m
   }[m
 [m
[31m-  // Check for admin routes[m
[31m-  if (pathname.startsWith('/admin')) {[m
[31m-    const token = request.cookies.get('next-auth.session-token')?.value[m
[31m-    if (!token || !hasValidTokenStructure(token)) {[m
[31m-      return NextResponse.redirect(new URL('/auth/signin', request.url))[m
[31m-    }[m
[31m-[m
[31m-    // Lightweight decode - full verification in API routes[m
[31m-    const decoded = decodeToken(token)[m
[31m-    if (!decoded || decoded.role !== 'ADMIN') {[m
[31m-      return NextResponse.redirect(new URL('/auth/signin', request.url))[m
[31m-    }[m
[31m-  }[m
[31m-[m
[31m-  // Check for candidate routes[m
[31m-  if (pathname.startsWith('/candidate')) {[m
[31m-    const token = request.cookies.get('candidate-token')?.value[m
[31m-    if (!token || !hasValidTokenStructure(token)) {[m
[31m-      return NextResponse.redirect(new URL('/candidate/login', request.url))[m
[31m-    }[m
[31m-[m
[31m-    // Lightweight decode - full verification in API routes[m
[31m-    const decoded = decodeToken(token)[m
[31m-    if (!decoded || decoded.role !== 'CANDIDATE') {[m
[31m-      return NextResponse.redirect(new URL('/candidate/login', request.url))[m
[31m-    }[m
[32m+[m[32m  // Allow API routes for authentication[m
[32m+[m[32m  if (allowedApiRoutes.some(route => pathname.startsWith(route))) {[m
[32m+[m[32m    return NextResponse.next()[m
   }[m
 [m
[31m-  // Check for voter routes[m
[31m-  if (pathname.startsWith('/voter')) {[m
[31m-    const token = request.cookies.get('voter-token')?.value[m
[31m-    if (!token || !hasValidTokenStructure(token)) {[m
[31m-      return NextResponse.redirect(new URL('/voter/login', request.url))[m
[31m-    }[m
[31m-[m
[31m-    // Lightweight decode - full verification in API routes[m
[31m-    const decoded = decodeToken(token)[m
[31m-    if (!decoded || !decoded.userId) {[m
[31m-      return NextResponse.redirect(new URL('/voter/login', request.url))[m
[31m-    }[m
[32m+[m[32m  // Allow only the specified public routes[m
[32m+[m[32m  if (allowedRoutes.some(route => pathname === route || pathname.startsWith(route + '/'))) {[m
[32m+[m[32m    return NextResponse.next()[m
   }[m
 [m
[31m-  return NextResponse.next()[m
[32m+[m[32m  // Block all other routes - redirect to landing page[m
[32m+[m[32m  return NextResponse.redirect(new URL('/', request.url))[m
 }[m
 [m
 export const config = {[m
   matcher: [[m
     /*[m
      * Match all request paths except for the ones starting with:[m
[31m-     * - api (API routes)[m
      * - _next/static (static files)[m
      * - _next/image (image optimization files)[m
      * - favicon.ico (favicon file)[m
[32m+[m[32m     * Note: API routes are handled in the middleware function itself[m
      */[m
[31m-    '/((?!api|_next/static|_next/image|favicon.ico).*)',[m
[32m+[m[32m    '/((?!_next/static|_next/image|favicon.ico).*)',[m
   ],[m
 }[m
